DX = 60.0
DY = 60.0
DZ = 60.0   # Shelf1 vertical shelf slot spacing (Z axis)

Z_UP   = 100.0
X_PULL = -100.0   # Shelf1 horizontal pull-out (x - 100)

INSPECT_TIME = 4.0   # 3~5s 느낌(대표값)

V_FAST = 50
A_FAST = 50
V_SLOW = 20
A_SLOW = 20

HOME_P = posx(367.22, 3.83, 201.28, 158.41, 179.96, 158.79)

S1_BASE = (750.39,  200.46, 250.92,   2.36,   88.13,   2.04)   # Shelf1 (Pick) base slot0
S2_BASE = (429.80, -258.59,  86.78, 115.36, -179.93, 116.26)  # Shelf2 base slot0
S3_BASE = (429.06,  213.83,  87.04, 154.82,  179.97, 155.23)  # Shelf3 base slot0

S1_AXIS = 'z'  # Shelf1: vertical shelf (Z changes by DZ)
S2_AXIS = 'x'  # Shelf2: slots along X
S3_AXIS = 'x'  # Shelf3: slots along X


def do_homing():
    pass

def slot_pose(base, i, axis):
    x0, y0, z0, A0, B0, C0 = base

    x = x0
    y = y0
    z = z0

    if axis == 'x':
        x = x0 + i * DX
    elif axis == 'y':
        y = y0 + i * DY
    elif axis == 'z':
        z = z0 + i * DZ

    return posx(x, y, z, A0, B0, C0)


def app_pose_zup(base, i, axis):
    # approach pose: same slot x/y/z (slot-calculated), but z + Z_UP
    x0, y0, z0, A0, B0, C0 = base

    # compute slot position first (supports x/y/z shelves)
    x = x0
    y = y0
    z = z0

    if axis == 'x':
        x = x0 + i * DX
    elif axis == 'y':
        y = y0 + i * DY
    elif axis == 'z':
        z = z0 + i * DZ

    return posx(x, y, z + Z_UP, A0, B0, C0)


def app_pose_xpull(base, i, axis, x_pull):
    # Shelf1 pull-out approach: compute slot position first (Z may change),
    # then offset X by x_pull, keep Y/Z the same
    x0, y0, z0, A0, B0, C0 = base

    x = x0
    y = y0
    z = z0

    if axis == 'x':
        x = x0 + i * DX
    elif axis == 'y':
        y = y0 + i * DY
    elif axis == 'z':
        z = z0 + i * DZ

    return posx(x + x_pull, y, z, A0, B0, C0)


def go_home():
    movel(HOME_P, v=V_FAST, a=A_FAST)


def go_slot_zup(base, i, axis):
    p_app  = app_pose_zup(base, i, axis)
    p_work = slot_pose(base, i, axis)
    movel(p_app,  v=V_FAST, a=A_FAST)
    movel(p_work, v=V_SLOW, a=A_SLOW)


def leave_slot_zup(base, i, axis):
    p_app = app_pose_zup(base, i, axis)
    movel(p_app, v=V_FAST, a=A_FAST)


def go_slot_xpull(base, i, axis, x_pull):
    p_app  = app_pose_xpull(base, i, axis, x_pull)
    p_work = slot_pose(base, i, axis)
    movel(p_app,  v=V_FAST, a=A_FAST)
    movel(p_work, v=V_SLOW, a=A_SLOW)


def leave_slot_xpull(base, i, axis, x_pull):
    p_app = app_pose_xpull(base, i, axis, x_pull)
    movel(p_app, v=V_FAST, a=A_FAST)


def main():
    # slot index selection (0,1,2,...)
    s1_idx = 0
    s2_idx = 0
    s3_idx = 0

    # Start at HOME
    go_home()

    # 1) Shelf1 visit (vertical shelf slots, horizontal pull-out approach)
    go_slot_xpull(S1_BASE, s1_idx, S1_AXIS, X_PULL)
    leave_slot_xpull(S1_BASE, s1_idx, S1_AXIS, X_PULL)
    go_home()

    # 2) Shelf2 visit + inspect wait (slots along X, Z-up approach)
    go_slot_zup(S2_BASE, s2_idx, S2_AXIS)
    wait(INSPECT_TIME)
    leave_slot_zup(S2_BASE, s2_idx, S2_AXIS)

    # 3) Shelf3 visit (slots along X, Z-up approach)
    go_slot_zup(S3_BASE, s3_idx, S3_AXIS)
    leave_slot_zup(S3_BASE, s3_idx, S3_AXIS)

    # Homing -> HOME
    do_homing()
    go_home()

main()
